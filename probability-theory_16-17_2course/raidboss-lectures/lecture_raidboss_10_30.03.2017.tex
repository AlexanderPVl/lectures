\section{Лекция от 30.03.2017}

\subsection{Количество связных графов с заданным количеством ребер}

В прошлой лекции мы выяснили, каков размер компонент в случайном
графе, если $np \to c, c \in (0, 1)$, возникает естественный вопрос ---
а как устроены эти компоненты. Как увидим, что-то сложное в данном
случае получаться будет очень редко, а в основном будут деревья и унициклы.

\begin{definition}
  Пусть $C(k, k + \ell), \ell \geq -1$ --- число связных графов на $k$ вершинах
  с $k + \ell$ ребрами.
\end{definition}

Вычислим эту величину при $\ell = -1, 0$. Благо при этих значениях как раз
и будут деревья и унициклы. При б\'{о}льших $\ell$ будут уже ужасные
асимптотические формулы, которые мы приведем без доказательства.

Мы хотим доказать две вещи:

\begin{itemize}
  \item $C(k, k - 1) = k^{k - 2}$, известная как формула Кэли;
  \item $C(k, k) = \frac12 (k - 1)! \sum\limits_{j = 0}^{k - 3} \frac{k^j}{j!}$.
\end{itemize}

Вывести эти формулы нам поможет следующая лемма:

\begin{lemma}
  Пусть $r$ вершин из $n$ ($r < n$) помечены числами $1, 2, \ldots, r$, тогда число
  лесов на $n$ вершинах, где помеченные вершины в разных деревьях, равно $n^{n - r - 1}r$.
\end{lemma}

\begin{proof}
  Подвесим все деревья за вершины $1, \ldots, r$. Теперь будем строить такой код:
  будем искать лист с наибольшим номером и писать его предка, удаляя этот лист.

  Так мы получим какую-то последовательность из $n - r$ чисел. Последняя вершина
  подсоединяется к одной из $r$ вершин, поэтому таких кодов будет не больше
  $n^{n - r - 1}r$.

  Теперь покажем, что любой код такой реализовывается. Пусть
  код состоит из $a_1, \ldots, a_{n - r}$.
  Будем
  смотреть на наибольший номер вершины, который ещё не использовали и подвешивать
  за вершину, которая находится в текущей последовательности (скажем, $a_i$).
  После этого удалим $a_i$ из последовательности и продолжим процедуру 
  (как раз последняя вершина может быть лишь одной из $r$). Так
  получим какой-то лес, в котором выписанный код будет совпадать с заданным.
\end{proof}

Давайте выведем две формулы, о которых говорили выше.

\begin{lemma}
  Пусть $k \geq 3$, тогда 
  \begin{itemize}
    \item[1.] $C(k, k - 1) = k^{k - 2}$;
    \item[2.] $C(k, k) = \frac12 (k - 1)! \sum\limits_{j = 0}^{k - 3} \frac{k^j}{j!}$.
  \end{itemize}
\end{lemma}

\begin{proof}
  Первый пункт сразу следует, если взять в доказанной только что лемме $r = 1$.

  Второй пункт чуть сложнее. Мы должны выбрать цикл длины $r$ 
  и на этом цикле навесить $r$ деревьев,
  то есть цисло общее число равно

  \[
    C(k, k) = \sum\limits_{r = 3}^k \binom{k}{r} \frac{r!}{2r} k^{k - r - 1}r
  \]

  Делим на $2r$ из-за размера группы автоморфизмов для циклов.

  После несложных преобразований получим:

  \[
    C(k, k) = \frac12 (k - 1)! \sum\limits_{r = 3}^k \frac{k^{k - r}}{(k - r)!}
    = \frac12 (k - 1)! \sum\limits_{j = 0}^{k - 3} \frac{k^j}{j!}
  \]
\end{proof}

Известны асимптотические результаты для некоторых $\ell$. Приведем их.

\begin{itemize}
  \item $C(k, k) \sim \sqrt{\dfrac{\pi}{8}}k^{k - \frac12}$;
  \item $C(k, k + 1) \sim \dfrac{5}{24} k^{k + 1}$;
  \item Если $\ell \geq 2$ и $\ell = o\left(k^{\frac13}\right)$, то $C(k, k + \ell) =
  \gamma_{\ell} k^{k + \frac{3\ell - 1}{2}}
  \left(1 + o\left(\sqrt{\frac{\ell^3}{k}}\right)\right)$, где
  $$\gamma_{\ell} = \dfrac{\sqrt{\pi} 3^{\ell}(\ell - 1)\delta_{\ell}}{2^{\frac{5\ell -1}{2}} 
  \Gamma\left(\frac{\ell}{2}\right)}$$ С условием на дельты: $$\delta_1 = \delta_2 = \frac{5}{36} \text{ и }
  \delta_{\ell + 1} = \delta_{\ell} + \sum\limits_{h = 1}^{\ell - 1} 
  \frac{\delta_h \delta_{\ell - h}}{\ell + 1} \frac{1}{\binom{\ell}{h}}$$

  \item Также есть теорема Боллобаша:

  Если $\ell \leq k$, тогда существует абсолютная константа $c_1$, что 
  \[
    C(k, k + \ell) \leq \left(\dfrac{c_1}{\ell}\right)^{
    \frac{\ell}{2}} k^{k + \frac{3\ell - 1}{2}}.
  \]

  Если $\binom{k}{2} - k \geq \ell > k$, тогда существует абсолютная константа $c_2$, что

  \[
    C(k, k + \ell) \leq \frac{c_2}{\ell^{\frac{\ell}{2}}} 
    k^{k + \frac{3\ell - 1}{2}}.
  \]
\end{itemize}


\subsection{Устройство компонент в случайном графе}

Будем называть компоненту \textit{сложной}, если в компоненте связности есть
хотя бы два цикла.

\begin{lemma}
  Если $np = 1 - s, s \in (0, 1)$ и $s$ может быть функцией, тогда
  \[
    \Pr{G(n, p)\text{ содержит сложную компоненту}} \leq \frac{2}{ns^3}
  \]
\end{lemma}

\begin{proof}
  Будем искать все конфигурации на $k$ вершинах, где ровно два цикла.

  Есть два различных случая --- когда конфигурация состоит из цикла-пути-цикла и
  когда один цикл разделен каким-то путём между двумя вершинами. Докажем, что
  суммарно таких конфигураций не больше $k! \cdot k^2$.

  Действительно, сначала рассмотрим, когда пути между циклами не пустые. Тогда
  надо выбрать порядок вершин, после этого два разделителя, которые ответят за то,
  какой путь между циклами, то есть таких путей не больше $2\binom{k}{2}k!$ (двойка из-за
  двух различных случаев).

  Если путь между циклами пустой, тогда эти варианты совпадают в обоих случаях.
  То есть надо выбрать один разделитель в перестановке, то есть ещё $k \cdot k!$
  вариантов, итого получаем $k! \cdot k^2$.

  Сложные компоненты могут появиться только, если $k \geq 4$, поэтому оценим
  вероятность $\Pr{G(n, p)\text{ содержит сложную компоненту}}$:

  \[
    \Pr{G(n, p)\text{ содержит сложную компоненту}} \leq \sum\limits_{k = 4}^n
    \binom{n}{k}k!k^2 p^{k + 1}
  \]

  Степень $k + 1$ выбрана, так как ребер хотя бы $k + 1$ в сложной компоненте.

  \begin{multline}
    \leq \sum\limits_{k = 4}^n \frac{n^k}{k!} k! k^2 p^{k + 1} = 
    \frac1n \sum\limits_{k = 4}^n k^2 (np)^{k + 1} \leq \frac1n \sum\limits_{k = 4}^n
    k^2 e^{-s(k + 1)} \leq \frac1n \int\limits_{0}^{+\infty} x^2e^{-sx}\,dx = \frac{2}{ns^3}
  \end{multline}

  Где мы воспользовались неравенством $1 - s \leq e^{-s}$ при $s \in (0, 1)$ и
  оценкой интегралом (можно честно проверить, что площадь под графиком
  будет больше), а также гаммой функцией.
\end{proof}

Получаем лёгкое следствие, что если $np \to c, c \in (0, 1)$, то сложных компонент
при $n \to +\infty$ просто нет.

Но есть более сильный результат -- получается, что унициклических графов тоже
очень маленькое количество. Точный результат даёт следующая лемма:

\begin{lemma}[об унициклических компонентах.]
  Пусть $np = c, c \neq 1, c > 0$, а $U_n$ --- общее число вершин, занимаемых
  унициклическими компонентами, тогда

  \[
    \begin{aligned}
      \E{U_n} \to \frac12 \sum\limits_{k = 3}^{+\infty} (ce^{-c})^k\sum\limits_{j = 0}^{k - 3} \frac{k^j}{j!},\\
      \D{U_n} \to \frac12 \sum\limits_{k = 3}^{+\infty} k(ce^{-c})^k\sum\limits_{j = 0}^{k - 3} \frac{k^j}{j!}
    \end{aligned}
  \]
\end{lemma}

\begin{proof}
  Пусть $U_n^{(k)}$ --- число унициклических компонент на $k$ вершинах. Тогда, так
  как ими занимается всего $k$ вершин, то:

  \[
    \E{U_n} = \sum\limits_{k = 3}^n k\E{U_n^{(k)}}
  \]

  А последнее нам достаточно хорошо известно, как считать --- надо на каждых
  $k$ вершинах из $n$ сделать уницикл и оставшиеся ребра, а также ребра снаружи не выбрать, откуда

  \[
    \E{U_n} = \sum\limits_{k = 3}^n k \binom{n}{k} C(k, k) p^{k} (1 - p)^{\binom{k}{2} - k + k(n - k)}
  \]

  Воспользуемся формулой $C(k, k)$, которую мы доказывали ранее.

  \[
    \E{U_n} = \sum\limits_{k = 3}^n  k \binom{n}{k} \frac12 (k - 1)! p^{k} 
    (1 - p)^{\binom{k}{2} - k + k(n - k)}
    \sum\limits_{j = 0}^{k - 3} \frac{k^j}{j!}
  \]

  Давайте поймём, куда стремится слагаемое при фиксированном $k$. Бином и
  $k!$ дадут в пределе $n^k$, что умноженное на $p^k$ даст $c^k$.

  Осталось разобраться с $(1 - p)^{kn - k^2 - \frac{3k}{2} + \frac{k^2}{2}}$. При
  фиксированном $k$ играет роль на предел только $kn$, но мы знаем, что 
  $p = \frac{c}{n}$, откуда это стремится к $e^{-ck}$, то есть каждое слагаемое
  при фиксированном $k$ и $n \to +\infty$ стремится к

  \[
    \frac12 (ce^{-c})^k \sum\limits_{j = 0}^{k - 3}\frac{k^j}{j!}.
  \]

  Это действительно то, что нам надо. Но остаётся вопрос о том, имеем ли мы право
  переходить к пределу, то есть в данном случае вопрос в том, можем ли мы
  переставить пределы. И чтобы это можно было сделать (как известно из курса
  математического анализа), надо, чтобы исходный ряд сходился равномерно по $n$.

  Для того, чтобы ряд сходился равномерно, достаточно мажорировать его
  равномерно сходящимся рядом, в данном случае мы будем мажорировать $e^{-\gamma k}$,
  где $\gamma > 0$ и является абсолютной константой.

  \[
    k! \binom{n}{k} = \frac{n!}{(n - k)!} = \Theta\left(\frac{n^n}{(n - k)^{n - k}}
    \sqrt{\frac{n}{n - k}} e^{-k}\right) = \Theta\left(n^k 
    \left(\frac{n}{n - k}\right)^{n - k + \frac12} e^{-k}\right)
  \]

  Теперь умножим это на $p^k$, а также заметим, что $1 - p \leq e^{-p}$ 
  и тогда

  \[
    (1 - p)^{\binom{k}{2} - k + k(n - k)} \leq 
    e^{-p\left(-\frac{k^2}{2} - \frac{3k}{2} + kn\right)}
  \]

  Стоит сказать, что про линейный по $k$ член в показателе можно забыть, так как
  $p = \frac{c}{n}$ и $\frac{3ck}{2n}$ при любом $k$ меньше фиксированной 
  константы, что не даст вклада в асимптотику, поэтому

  \[
    = \Theta\left(e^{-p\left(-\frac{k^2}{2} + kn\right)}\right)
  \]

  И последняя сумма не больше, чем $e^k$ из-за разложения ряда Тейлора, откуда,
  перемножив всё, получаем, что каждое слагаемое не больше, чем

  \[
    \Theta\left(c^k \left(\frac{n}{n - k}\right)^{n - k + \frac12} 
    e^{-p\left(-\frac{k^2}{2} + kn\right)} e^k e^{-k}\right) =
    \Theta\left(c^k \left(\frac{n}{n - k}\right)^{n - k + \frac12} 
    e^{-p\left(-\frac{k^2}{2} + kn\right)}\right)
  \]

  Надо сделать несколько замечаний, первое из них --- $n = k$ нам не важно, так
  как мы можем взять $n + 1$ и последующая оценка не будет зависеть от $n$.

  Мы хотим это выражение оценить $e^{-\gamma k}$. Давайте поймём, что 
  $\sqrt{\frac{n}{n - k}}$ не сыграет роли. Действительно, 

  \[
    \frac1k\frac{n}{n - k} = \frac1k + \frac{1}{n - k} \leq 2
  \]

  То есть $\sqrt{\frac{n}{n - k}} = \mathcal{O}(\sqrt{k})$.

  И тогда мажоранта примет вид $\sqrt{k}e^{-\gamma k}$, но ряд будет по-прежнему
  сходиться!

  Поэтому будем оценивать 
  $\Theta\left(c^k \left(\frac{n}{n - k}\right)^{n - k} 
    e^{-p\left(-\frac{k^2}{2} + kn\right)}\right)$ как $e^{f(\beta) k}$, где
  $\beta = \frac{k}{n}$.

  После взятия логарифма и деления на $k$ получим:

  \[
    f(\beta) = \ln c + \left(\frac{1}{\beta} - 1\right)\ln (1 - \beta)^{-1} - c + \frac{c\beta}{2}
  \]

  Теперь надо доказать, что $f(\beta) < -\gamma$ при достаточно больших $n$ и
  \textbf{любом} $\beta \in (0, 1]$ (что естественно, так как $0 < \frac{k}{n}
  \leq 1$).

  Посчитаем предел при $\beta \to 0$, получим:

  \[
    \lim\limits_{\beta \to 0} f(\beta) = \ln c - c + 1
  \]

  Доопределим $f$ в нуле именно таким значением. Откуда $f$ будет непрерывна
  при $\beta \in [0, 1]$ (в единице легко посчитать предел, он будет равен 
  $\ln c - \frac{c}{2}$).

  Плюс единица идет из-за того, что 
  $\lim\limits_{\beta \to 0} \frac{\ln (1 - \beta)}{\beta} = -1$.


  \[
    f(0) = \ln c + 1 - c < 0 \text{ при } c \neq 1.
  \]

  Действительно, производная по $c$ равна $\frac{1}{c} - 1$. Ноль производной
  только в $c = 1$, и производная сначала положительная, потом отрицательная,
  значит при $c = 1$ будет точка максимума. А в этой точке как раз и достигается
  ноль.

  Так как в нуле значение функции меньше нуля, значит существует окрестность
  $[0, \beta_0]$, где $f(\beta) < \frac{f(0)}{2} < 0 \ \forall \beta \in [0, \beta_0]$.

  Но этого ещё недостаточно для окончательной оценки! Рассмотрим функцию

  \[
    g(\beta) = \beta f(\beta) = \beta \ln c + (1 - \beta) \ln (1 - \beta)^{-1} - c\beta + \frac{c\beta^2}{2}
  \]

  Будем исследовать эту функцию. Возьмём первые и вторые производные $g(\beta)$:

  \begin{align}
    &g'(\beta) = \ln c + \ln (1 - \beta) + 1 - c + c\beta,\\
    &g''(\beta) = -\frac{1}{1 - \beta} + c
  \end{align}

  Откуда получаем, что $\beta = 1 - \frac1c$ --- точка максимума первой производной
  функции $g$ (так как вторая производная меняет знак с плюса на минус). Подставим эту
  точку в первую производную:

  \[
    g'\left(1 - \frac1c\right) = \ln c + 1 - \ln c - c + c - 1 = 0
  \]

  То есть в точке максимума функция равна нулю! Откуда производная всегда
  не положительная для всех $\beta \in (-\infty, 1)$ (да, можно убедиться в том,
  что производные никак не использовали специфику того, что $\beta \geq 0$).

  Откуда получаем, что

  \[
    \beta f(\beta) \leq g(\beta_0) \ \forall \beta \geq \beta_0 
  \]

  Заметим, что $g(0) = 0$, откуда получаем, что $f(\beta) \leq \beta f(\beta)
  \ \forall \beta \in [0, 1)$, так как при $\beta > 0$ следует, что $g(\beta) < 0$,
  а при $\beta = 0$ и так получаем верное равенство.

  Откуда для всех $\beta \geq \beta_0$ верно, что $f(\beta) \leq g(\beta) 
  \leq g(\beta_0) < 0$, так как $\beta_0 > 0$. Осталось заткнуть дырку при 
  $\beta = 1$, но это сделать легко из-за непрерывности и тому, что при $\beta \to 1$
  у функции $g(\beta)$ существует предел.

  Итак, мы получили, что 

  \[
    \forall \beta \in [0, 1] \implies f(\beta) \leq
    \max\left(\frac{f(0)}{2}, g(\beta_0)\right) = -\gamma < 0
  \]

  Получили равномерную сходимость ряда, что нам и требовалось в данном случае,
  то есть

  \[
    \E{U_n} \to \frac12 \sum\limits_{k = 3}^{+\infty} (ce^{-c})^k\sum\limits_{j
    = 0}^{k - 3} \frac{k^j}{j!}.
  \]

  Теперь надо разобраться с дисперсией.

  Давайте поймём, что при фиксированных $k_1 \neq k_2$ имеет место следующее равенство

  \[
    \E{U_n^{(k_1)} U_n^{(k_2)}} \sim \E{U_n^{(k_1)}}\E{U_n^{(k_2)}} \text{ с ростом } n
  \]

  Это утверждение вызывает полный катарсис, но давайте поймём физический смысл
  того, что написано. Говорится о том, что с ростом $n$ количество унициклических
  компонент на $k_1$ и $k_2$ вершинах почти друг на друга не влияют. Оно и понятно,
  так как $k_1$ и $k_2$ становятся пренебрежительно маленькими и почти не влияют
  друг на друга, то есть

  \begin{multline}
    \E{U_n^{(k_1)} U_n^{(k_2)}} = \binom{n}{k_1} C(k_1, k_1) p^{k_1} 
    (1 - p)^{\binom{k_1}{2} - k_1 + k_1(n - k_1)}\cdot\\\cdot \binom{n - k_1}{k_2} 
    C(k_2, k_2) p^{k_2} (1 - p)^{\binom{k_2}{2} - k_2 + k_2(n - k_2)} (1 - p)^{-k_1k_2}
  \end{multline}

  Такое равенство можно написать из-за того, что $k_1 \neq k_2$ и не посчитаем
  пары унициклов несколько раз.

  И действительно, отличие от произведения только в биномиальном коэффициенте,
  который асимптотически будет равен $\binom{n}{k_2}$, так как в числителе будут
  $k_2$ множителей, которые в пределе ничем не отличаются от тех же $k_2$ множителей
  в $\binom{n - k_1}{k_2}$ и в последнем множителе, который равномерно стремится к 1

  При $k_1 = k_2$ возникает следующая картина, что таким свойством обладает
  факториальный момент:

  \[
    \E{U_n^{(k_1)}(U_n^{(k_1)} - 1)} \sim \E{U_n^{(k_1)}}\E{U_n^{(k_1)}}
  \]

  Суть здесь такая же, только мы должны посчитать \textbf{другую}
  унициклическую компоненту, откуда

  \[
    \E{\left(U_n^{(k_1)}\right)^2} \sim \left(\E{U_n^{(k_1)}}\right)^2 + \E{U_n^{(k_1)}}
  \]

  Подготовка к окончательному результату дисперсии готова. Вспомним, что
  $U_n = \sum\limits_{k = 3}^{n} kU_n^{(k)}$. Так как мы доказали равномерную
  сходимость ряда для $\E{U_n}$, то для квадрата будет также равномерная сходимость
  (так как каждое слагаемое будет оценено по геометрической прогрессии по 
  $k_1 + k_2$, желающие могут это обосновать совсем строго).
  Значит можно менять пределы местами и 
  переходить к пределу при фиксированных $k_1$ и $k_2$:

  \begin{multline}
    \E{U_n^2} = \E{\left(\sum\limits_{k = 3}^{n} k U_n^{(k)}\right)^2} =
    \sum\limits_{k_1, k_2} k_1 k_2 \E{U_n^{(k_1)} U_n^{(k_2)}} \sim\\\sim
    \sum\limits_{k_1 \neq k_2} k_1 k_2 \E{U_n^{(k_1)}}\E{U_n^{(k_2)}} +
    \sum\limits_{k} k^2 \left(\E{U_n^{(k)}}\right)^2 + \sum\limits_{k} k^2
    \E{U_n^{(k)}} = \left(\E{U_n}\right)^2 + \sum\limits_{k} k^2\E{U_n^{(k)}}
  \end{multline}

  Откуда из-за всё той же равномерной сходимости:

  \[
    \D{U_n} = \sum\limits_{k} k^2 \E{U_n^{(k)}} \to \frac12 \sum\limits_{k = 3}^{
    +\infty} k(ce^{-c})^k\sum\limits_{j = 0}^{k - 3} \frac{k^j}{j!}
  \]

\end{proof}

Мы получаем легкое следствие из этой теоремы.

\begin{consequence}
  Пусть $np = c \neq 1$, тогда $U_n = \mathcal{O}_p(1)$, то есть
  для любой функции $w(n) \to +\infty$ верно, что $\Pr{U_n \leq w(n)} \to 1$.

  \begin{proof}
    По лемме об унициклической компоненте

    \[
      \E{U_n} \to \frac12 \sum\limits_{k = 3}^{+\infty} (ce^{-c})^k
      \sum\limits_{j = 0}^{k - 3} \frac{k^j}{j!} \leq
      \frac12 \sum\limits_{k = 3}^{+\infty} (ce^{-c + 1})^k
    \]

    Проверим, что $xe^{-x + 1} < 1$ при $x \neq 1$. Производная равна
    $e^{-x + 1} - xe^{-x + 1}$, то есть единственная подозрительная
    точка --- $x = 1$, но в ней как раз и будет значение один. При
    бесконечности и минус бесконечности пределы равны $-\infty$ и $0$,
    поэтому максимум будет единственный и в точке $x = 1$.

    Поэтому мы оценили сверху геометрической прогрессией с членом,
    меньшим единицы, то есть

    \[
      \E{U_n} \to C, \text{ где $C < +\infty$.}
    \]

    Поэтому

    \[
      \Pr{U_n > w(n)} \leq \frac{\E{U_n}}{w(n)} = 
      \mathcal{O}\left(\frac{1}{w(n)}\right) \to 0
    \]
  \end{proof}
\end{consequence}
